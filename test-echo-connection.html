<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Echo Connection</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .log {
            background: #000;
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid #00ff00;
        }
        .error { border-color: #ff0000; color: #ff0000; }
        .success { border-color: #00ff00; color: #00ff00; }
        .info { border-color: #00aaff; color: #00aaff; }
    </style>
</head>
<body>
    <h1>üîå Test de Conexi√≥n Echo/Reverb</h1>
    <div id="logs"></div>

    <script src="https://cdn.jsdelivr.net/npm/pusher-js@8.3.0/dist/web/pusher.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/laravel-echo@1.15.3/dist/echo.iife.js"></script>

    <script>
        const logs = document.getElementById('logs');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(div);
            console.log(message);
        }

        log('Iniciando test de conexi√≥n...', 'info');

        window.Pusher = Pusher;

        try {
            window.Echo = new Echo({
                broadcaster: 'reverb',
                key: 'local-key',
                wsHost: 'localhost',
                wsPort: 8080,
                wssPort: 8080,
                forceTLS: false,
                enabledTransports: ['ws', 'wss'],
                disableStats: true,
            });

            log('‚úÖ Echo inicializado correctamente', 'success');

            // Escuchar cambios de estado de conexi√≥n
            window.Echo.connector.pusher.connection.bind('state_change', function(states) {
                log(`Estado de conexi√≥n: ${states.previous} ‚Üí ${states.current}`, 'info');
            });

            window.Echo.connector.pusher.connection.bind('connected', function() {
                log('‚úÖ CONECTADO a Reverb!', 'success');
            });

            window.Echo.connector.pusher.connection.bind('disconnected', function() {
                log('‚ùå DESCONECTADO de Reverb', 'error');
            });

            window.Echo.connector.pusher.connection.bind('error', function(err) {
                log(`‚ùå Error de conexi√≥n: ${JSON.stringify(err)}`, 'error');
            });

            // Suscribirse a canales de prueba
            log('Suscribi√©ndose al canal "admin"...', 'info');
            window.Echo.channel('admin')
                .listen('.pedido.creado', (e) => {
                    log(`üéâ EVENTO RECIBIDO - pedido.creado: ${JSON.stringify(e)}`, 'success');
                })
                .listen('.pedido.cambio-estado', (e) => {
                    log(`üéâ EVENTO RECIBIDO - pedido.cambio-estado: ${JSON.stringify(e)}`, 'success');
                });

            log('Suscribi√©ndose al canal "cocina"...', 'info');
            window.Echo.channel('cocina')
                .listen('.pedido.creado', (e) => {
                    log(`üéâ EVENTO RECIBIDO (cocina) - pedido.creado: ${JSON.stringify(e)}`, 'success');
                });

            log('Esperando eventos... Crea un pedido en la aplicaci√≥n.', 'info');

        } catch (error) {
            log(`‚ùå Error al inicializar Echo: ${error.message}`, 'error');
        }
    </script>
</body>
</html>


